<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Note Taker</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css"   href="css/notes-style.css"/>
  </head>

  <body>
    <div class="grid-container">
      <header><h3>Note Taker</h3>
        <div class="saveBtn fa fa-floppy-o"></div>
        <a href="/api/notes">Raw Notes</a>
      </header>
      <section>
        <ul id="my-notes" class="list-group">
        </ul>
      </section>
      <main>
        <textarea id="note-title" type="text" placeholder="Note Title"></textarea>
        <textarea id="note-content" type="text" placeholder="Note Text"></textarea>
      </main>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript">
  
  //appends notes to #my-notes list
  const addNotes = (notesData) => {
      for (noteObj of notesData) {
        let myNotes = $('#my-notes');
        let note = $(document.createElement('li'));
        note.addClass('list-group-item');
        note.css('fontSize', '1.5rem');
        note.text(`${noteObj.noteTitle}`);
        note.text(`${noteObj.noteContent}`);
        note.on("click", noteObj, function(e) {
          document.getElementById('note-title').textContent = e.data.noteTitle;
          document.getElementById('note-content').textContent = e.data.noteContent;
        });  
        myNotes.append(note); 
      }
    }

  const saveBtn = $(document.querySelector('.saveBtn'));
  saveBtn.on('click', (e) => {
    e.preventDefault();

    // Retrieve textarea input
    let newNote = {
      noteTitle: document.getElementById('note-title').value.trim(),
      noteContent: document.getElementById('note-content').value.trim(),
    };
    fetch('/api/notes', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(newNote),
    })
      .then((res) => res.json()) //write to db.json
      .then((data) => {
        console.log(data);
        
      })
      .catch((err) => {
        console.log('An error occurred in POST -', err);
      });
  });

  const notesQuery = () => {
      fetch('/api/notes', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
      })
        .then((res) => res.json())
        .then((notesData) => addNotes(notesData))
        .catch((err) => {
          console.log('An error occurred in GET -', err);
        });
    };
    notesQuery();
</script>
</body>
</html>
